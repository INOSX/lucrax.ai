# Lucrax.ai - Regras do Ambiente de Desenvolvimento

## Ambiente de Desenvolvimento
- **URL**: https://staging.lucrax.ai
- **Branch**: develop
- **Deploy**: Automático via GitHub (push/merge em `develop`)
- **Configuração**: Variáveis de ambiente de desenvolvimento
- **Organização**: INOSX
- **Projeto ID**: prj_ig3SKAuvThlZSSXmxyWxfveweeKH

## Regras de Deploy para Desenvolvimento

### ✅ Permitido SEMPRE
- **SEMPRE trabalhar no branch `develop`**
- Push/merge para `develop` (CI dispara deploy no Staging)
- Testes em ambiente de desenvolvimento
- Correções e novas funcionalidades
- Criação de branches feature a partir de `develop`

### ❌ Proibido SEMPRE
- **NUNCA trabalhar diretamente no branch `main`**
- Deploy manual para produção
- Alteração de configurações de produção
- Push direto para `main` sem solicitação explícita

## Fluxo de Trabalho OBRIGATÓRIO
1. **SEMPRE trabalhar no branch `develop`**
2. Crie branches feature a partir de `develop`
3. Abra PR para `develop`
4. Após merge, o Staging é atualizado automaticamente (Vercel)
5. **Para produção**: APENAS quando usuário solicitar explicitamente
   - Usuário deve pedir: "faça deploy para produção" ou "merge para main"
   - Então criar PR `develop` → `main`
   - Após merge, a Produção é atualizada automaticamente (Vercel)

## Monitoramento
- Health check: https://staging.lucrax.ai/api/health
- Logs de debug em tempo real
- Métricas de performance

## Rollback de Desenvolvimento
```bash
# 1. Selecionar deployment anterior no Vercel
# 2. Redeploy (ou reatribuir alias de staging)
# 3. Verificar funcionamento
curl https://staging.lucrax.ai/api/health
```

## Configurações de Desenvolvimento

### Variáveis de Ambiente
- NODE_ENV=development
- VERCEL_ENV=development
- DEBUG=true
- LOG_LEVEL=debug
- Supabase: Projeto de desenvolvimento (mesmo da produção)
- OpenAI: API key de desenvolvimento

### Segurança
- CORS configurado para domínio de desenvolvimento
- Rate limiting ativado (mais permissivo)
- Logs detalhados habilitados
- Monitoramento de performance ativo

### Monitoramento
- Health check: https://staging.lucrax.ai/api/health
- Logs de debug em tempo real
- Métricas de performance
- Alertas de falhas (menos críticos)

## Checklist de Deploy para Desenvolvimento

### Antes do Deploy
- [ ] **Código testado** localmente
- [ ] **Testes unitários** passando
- [ ] **CHANGELOG.md atualizado**
- [ ] **Documentação atualizada**

### Durante o Deploy
- [ ] **Branch develop** ativo
- [ ] **Deploy automático** executado
- [ ] **URL de desenvolvimento** verificada
- [ ] **Funcionalidades testadas**

### Após o Deploy
- [ ] **Testes de integração** realizados
- [ ] **Logs verificados** para erros
- [ ] **Performance verificada**
- [ ] **Preparação para produção** avaliada

## Testes em Desenvolvimento

### Testes Obrigatórios
- [ ] **Carregamento de dados** do Google Sheets
- [ ] **Geração de gráficos** (todos os tipos)
- [ ] **Análise com IA** (OpenAI)
- [ ] **Integração com Supabase**
- [ ] **Performance** da API
- [ ] **Interface** responsiva

### Testes de Integração
- [ ] **Fluxo completo** de dados
- [ ] **Persistência** no banco
- [ ] **CORS** funcionando
- [ ] **Rate limiting** adequado
- [ ] **Logs** sendo gerados

## Alertas e Notificações

### Deploy de Desenvolvimento
- ✅ Log: "Deploy de desenvolvimento realizado"
- ✅ Notificação: "Ambiente de desenvolvimento atualizado"
- 📧 Email: "Deploy de desenvolvimento realizado em [timestamp]"

### Falhas em Desenvolvimento
- ⚠️ Alerta: "Falha em desenvolvimento"
- 📞 Notificação: "Verificar desenvolvimento"
- 🔄 Rollback: "Considerar rollback se necessário"

## Regras de Acesso

### Quem Pode Fazer Deploy
- Qualquer desenvolvedor autorizado
- Deploy automático ao fazer push
- Desenvolvimento contínuo

### Quem Pode Fazer Rollback
- Desenvolvedor autorizado
- Em caso de falha crítica
- Com justificativa documentada

## Backup e Recuperação

### Backup Automático
- Backup antes de cada deploy
- Backup diário do banco de dados
- Backup semanal dos arquivos

### Recuperação
- Tempo de recuperação: < 10 minutos
- Procedimento documentado
- Teste semanal de recuperação

## Monitoramento de Desenvolvimento

### Métricas Importantes
- Tempo de resposta da API
- Taxa de erro por endpoint
- Uso de recursos (CPU, memória)
- Requisições por minuto

### Alertas Configurados
- Tempo de resposta > 5 segundos
- Taxa de erro > 5%
- Uso de CPU > 80%
- Falhas de integração

## Preparação para Produção

### Checklist Pré-Produção
- [ ] **Todos os testes** passando
- [ ] **Performance** adequada
- [ ] **Logs** limpos
- [ ] **Documentação** atualizada
- [ ] **CHANGELOG** atualizado
- [ ] **Aprovação** do usuário

### Critérios de Aprovação
- Zero erros críticos
- Performance < 3 segundos
- Todos os testes passando
- Documentação completa
- Confirmação explícita do usuário